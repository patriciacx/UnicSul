corrplot(cor(dados.scale), type="upper")
variaveis <- cbind(paste('X',1:18, sep =''),
colnames(dados.join)[3:20])
variaveis
colnames(dados.join)[3:20] <- paste('X',1:18, sep ='')
write.csv2(dados.join, 'base_boletins_tcc.csv',row.names=FALSE)
write.csv2(variaveis, 'variaveis.csv',row.names=FALSE)
View(dados.join)
setwd('C:/Users/Patricia/Google Drive/Cruzeiro/POS - TCC')
library(tidyverse)
library(corrplot)
library(psych)
library(knitr)
setwd('C:/Users/Patricia/Google Drive/Cruzeiro/POS - TCC')
dados <- read.csv2('base_boletins_tcc.csv', sep=';')
glimpse(dados)
getwd()
```{r}
setwd('C:/Users/Patricia/Documents/GitHub/UnicSul')
dados <- read.csv2('base_boletins_tcc.csv', sep=';')
glimpse(dados)
dados.scale <- scale(dados[,-c(1:2)]) %>% as.data.frame()
bartlett.test(dados)
bartlett.test(dados.scale)
#cor(dados.scale)
corrplot(cor(dados.scale), type="upper")
# Ajuste do modelo - escolha do numero de componentes
fit1 <- princomp(dados.scale, cor=TRUE)
summary(fit1)
# Scree Plot
plot(fit1, type="lines")
fit2 <- principal(dados.scale, covar = FALSE, nfactors = 4)
fit2
corrplot(t(fit2$loadings))
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
getwd()
arquivo <- read.csv("tcc_dataset.csv", encoding="UTF-8")
dados <- arquivo[,c('delegacia_id', 'Natureza', 'Total')]
delegacias <- read.csv("delegacias.csv", encoding="UTF-8", sep=';')
dados <- dados %>% spread(key='Natureza',value = 'Total')
colnames(delegacias)[1] <- 'delegacia_id'
dados.join <- left_join(x= dados,
y=delegacias,
by='delegacia_id')
dados.join <- dados.join[,c(1,25,2:24)]
glimpse(dados.join)
## RETIRANDO VARIAVEIS DE TOTAIS
dim(dados.join)
dados.join[,24:25] <- NULL
head(dados.join[,16:18])
dados.join[,16:18] <- NULL
dim(dados.join)
glimpse(dados.join)
variaveis <- cbind(paste('X',1:18, sep =''),
colnames(dados.join)[3:20])
variaveis
View(variaveis)
arquivo <- read.csv("tcc_dataset.csv", encoding="UTF-8")
delegacias <- read.csv("delegacias.csv", encoding="UTF-8", sep=';')
dados <- arquivo[,c('delegacia_id', 'Natureza', 'Total')]
dados <- dados %>% spread(key='Natureza',value = 'Total')
colnames(delegacias)[1] <- 'delegacia_id'
dados.join <- left_join(x= dados,
y=delegacias,
by='delegacia_id')
dados.join <- dados.join[,c(1,25,2:24)]
glimpse(dados.join)
glimpse(dados.join)
dados.join[,'HOMICÍDIO DOLOSO (2)']
dados.join[,'HOMICÍDIO DOLOSO POR ACIDENTE DE TRÂNSITO']
dados.join$HomicidioDolosoExcetoTransito <- dados.join[,'HOMICÍDIO DOLOSO (2)'] -
dados.join[,'HOMICÍDIO DOLOSO POR ACIDENTE DE TRÂNSITO']
glimpse(dados.join)
dados.join[,'HOMICÍDIO DOLOSO (2)'] <- NULL
dados.join[,'HOMICÍDIO DOLOSO POR ACIDENTE DE TRÂNSITO']<- NULL
## RETIRANDO VARIAVEIS DE TOTAIS
dim(dados.join)
## RETIRANDO VARIAVEIS DE TOTAIS
glimpse(dados.join)
dim(dados.join)
head(dados.join[,24:25])
head(dados.join[,24:25])
## RETIRANDO VARIAVEIS DE TOTAIS
glimpse(dados.join)
dim(dados.join)
head(dados.join[,22:23])
dados.join[,22:23] <- NULL
## RETIRANDO AS VARIÁVEIS DE NUMERO DE VÍTIMAS
glimpse(dados.join)
dim(dados.join)
head(dados.join[,14:16])
dados.join[,14:16] <- NULL
dim(dados.join)
glimpse(dados.join)
dim(dados.join)
colnames(dados.join)
arquivo <- read.csv("tcc_dataset.csv", encoding="UTF-8")
delegacias <- read.csv("delegacias.csv", encoding="UTF-8", sep=';')
dados <- arquivo[,c('delegacia_id', 'Natureza', 'Total')]
dados <- dados %>% spread(key='Natureza',value = 'Total')
colnames(delegacias)[1] <- 'delegacia_id'
dados.join <- left_join(x= dados,
y=delegacias,
by='delegacia_id')
dados.join <- dados.join[,c(1,25,2:24)]
glimpse(dados.join)
dados.join[,'HOMICÍDIO DOLOSO (2)']
dados.join[,'HOMICÍDIO DOLOSO POR ACIDENTE DE TRÂNSITO']
dados.join$HomicidioDolosoExcetoTransito <- dados.join[,'HOMICÍDIO DOLOSO (2)'] -
dados.join[,'HOMICÍDIO DOLOSO POR ACIDENTE DE TRÂNSITO']
dados.join[,'HOMICÍDIO DOLOSO (2)'] <- NULL
## RETIRANDO VARIAVEIS DE TOTAIS
glimpse(dados.join)
dim(dados.join)
## RETIRANDO VARIAVEIS DE TOTAIS
glimpse(dados.join)
head(dados.join[,22:23])
head(dados.join[,22:24])
head(dados.join[,22:24])
dados.join[,22:24] <- NULL
## RETIRANDO AS VARIÁVEIS DE NUMERO DE VÍTIMAS
glimpse(dados.join)
## RETIRANDO AS VARIÁVEIS DE NUMERO DE VÍTIMAS
glimpse(dados.join)
## RETIRANDO AS VARIÁVEIS DE NUMERO DE VÍTIMAS
dim(dados.join)
glimpse(dados.join)
head(dados.join[,15:17])
dados.join[,15:17] <- NULL
dim(dados.join)
glimpse(dados.join)
dim(dados.join)
variaveis <- cbind(paste('X',1:19, sep =''),
colnames(dados.join)[3:22])
colnames(dados.join)[3:22]
colnames(dados.join)
colnames(dados.join)[3:19]
variaveis <- cbind(paste('X',1:17, sep =''),
colnames(dados.join)[3:19])
variaveis
colnames(dados.join)[3:19] <- paste('X',1:19, sep ='')
colnames(dados.join)
variaveis
colnames(dados.join)[3:19]
paste('X',1:19, sep ='')
colnames(dados.join)
write.csv2(dados.join, 'base_boletins_tcc.csv',row.names=FALSE)
write.csv2(variaveis, 'variaveis.csv',row.names=FALSE)
View(dados.join)
library(tidyverse)
library(dplyr)
library(tidyr)
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
getwd()
arquivo <- read.csv("tcc_dataset.csv", encoding="UTF-8")
delegacias <- read.csv("delegacias.csv", encoding="UTF-8", sep=';')
dados <- arquivo[,c('delegacia_id', 'Natureza', 'Total')]
dados <- dados %>% spread(key='Natureza',value = 'Total')
colnames(delegacias)[1] <- 'delegacia_id'
dados.join <- left_join(x= dados,
y=delegacias,
by='delegacia_id')
dados.join <- dados.join[,c(1,25,2:24)]
glimpse(dados.join)
# SUBTRAINDO HOMICIDIOS
dados.join[,'HOMICÍDIO DOLOSO (2)']
dados.join[,'HOMICÍDIO DOLOSO POR ACIDENTE DE TRÂNSITO']
dados.join$HomicidioDolosoExcetoTransito <- dados.join[,'HOMICÍDIO DOLOSO (2)'] -
dados.join[,'HOMICÍDIO DOLOSO POR ACIDENTE DE TRÂNSITO']
dados.join[,'HOMICÍDIO DOLOSO (2)'] <- NULL
## RETIRANDO VARIAVEIS DE TOTAIS
glimpse(dados.join)
dim(dados.join)
head(dados.join[,22:24])
dados.join[,22:24] <- NULL
## RETIRANDO AS VARIÁVEIS DE NUMERO DE VÍTIMAS
dim(dados.join)
glimpse(dados.join)
head(dados.join[,15:17])
dados.join[,15:17] <- NULL
dim(dados.join)
glimpse(dados.join)
#RENOMEANDO AS VARIAVEIS
variaveis <- cbind(paste('X',1:17, sep =''),
colnames(dados.join)[3:19])
variaveis
colnames(dados.join)[3:19] <- paste('X',1:19, sep ='')
### CONSIDERANDO SOMENTE AS DELECAGIAS REGIONAIS
substr(x, start=n1, stop=n2)
dados.join <- dados.join[substr(dados.join$delegacia,5,6) == 'DP',]
write.csv2(dados.join, 'base_boletins_tcc.csv',row.names=FALSE)
write.csv2(variaveis, 'variaveis.csv',row.names=FALSE)
View(dados.join)
library(tidyverse)
library(corrplot)
library(psych)
library(knitr)
dados <- read.csv2('base_boletins_tcc.csv', sep=';')
glimpse(dados)
dados.scale <- scale(dados[,-c(1:2)]) %>% as.data.frame()
bartlett.test(dados)
bartlett.test(dados.scale)
#cor(dados.scale)
corrplot(cor(dados.scale), type="upper")
# Ajuste do modelo - escolha do numero de componentes
fit1 <- princomp(dados.scale, cor=TRUE)
summary(fit1)
# Scree Plot
plot(fit1, type="lines")
fit2 <- principal(dados.scale, covar = FALSE, nfactors = 5)
fit2
corrplot(t(fit2$loadings))
View(dados.scale)
View(dados.join)
View(dados.join)
knitr::opts_chunk$set(echo = FALSE)
if(!require(tidyverse)){install.packages("tidyverse")}
if(!require(cluster)){install.packages("cluster")}
if(!require(NbClust)){install.packages("NbClust")}
if(!require(pvclust)){install.packages('pvclust')}
if(!require(ggplot2)){install.packages('ggplot2')}
#if(!require(gridExtra)){install.packages('gridExtra')}
if(!require(plotly)){install.packages('plotly')}
# within sum of squares
wss <- function(d) {
sum(scale(d, scale = FALSE)^2)
}
# wrap the data
wrap <- function(i, hc, x) {
cl <- cutree(hc, i)
spl <- split(x, cl)
wss <- sum(sapply(spl, wss))
wss
}
elbow_plot<- function(data, dissim,met){
cl = hclust(dissim, method = met)
res <- sapply(seq.int(1, nrow(data)),
wrap, h =cl,
x = data)
return(res)
}
fit2$scores
---
title: "ACP Boletins"
author: "Patricia Felipe e Leandro"
date: "11 de junho de 2019"
output: html_document
---
Carregando Pacotes:
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(corrplot)
library(psych)
library(knitr)
```
Lendo Arquivo:
```{r}
dados <- read.csv2('base_boletins_tcc.csv', sep=';')
glimpse(dados)
```
Escalonamento:
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
dados.scale <- scale(dados[,-c(1:2)]) %>% as.data.frame()
```
Teste de esfericidade
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
bartlett.test(dados)
bartlett.test(dados.scale)
```
Correlações
```{r}
#cor(dados.scale)
corrplot(cor(dados.scale), type="upper")
```
```{r}
# Ajuste do modelo - escolha do numero de componentes
fit1 <- princomp(dados.scale, cor=TRUE)
summary(fit1)
```
```{r}
# Scree Plot
plot(fit1, type="lines")
```
Seguindo a Análise com 6 componentes:
```{r message=FALSE, warning=FALSE, paged.print=FALSE}
fit2 <- principal(dados.scale, covar = FALSE, nfactors = 5)
fit2
```
```{r}
corrplot(t(fit2$loadings))
```
Relações:
RC1:
<br>**X1** - Estupro
<br>**X2** - Estupro de Vulnerável
<br>**X6** - HOMICÍDIO CULPOSO POR ACIDENTE DE TRÂNSITO
<br>**X11** - LESÃO CORPORAL DOLOSA
<br>**x15** - ROUBO DE CARGA
<br>**x17** - Homicidio doloso exceto transito
RC4:
<br>**X3** - FURTO OUTROS *NEGATIVO*
<br>**X4** - FURTO DE VEÍCULO
<br>**10** - LESÃO CORPORAL CULPOSA POR ACIDENTE DE TRÂNSITO
RC2:
<br>**X9** - LESÃO CORPORAL CULPOSA - OUTRAS
<br>**X14**- ROUBO A BANCO
<br>**X16**- ROUBO DE VEÍCULO *NEGATIVO*
RC3:
<br>**X5** - HOMICÍDIO CULPOSO OUTROS
<br>**X12** - LESÃO CORPORAL SEGUIDA DE MORTE
RC5:
<br>**X7** - HOMICÍDIO DOLOSO POR ACIDENTE DE TRÂNSITO
<br>**X13** - ROUBO - OUTROS
fit2$scores
dados[,[1:2]]
dados[,1:2]
base_acp_scores <-
cbind( dados[,1:2],
fit2$scores)
head(base_acp_scores)
write.csv2(dados.join, 'base_acp_scores.csv',row.names=FALSE)
write.csv2(base_acp_scores, 'base_acp_scores.csv',row.names=FALSE)
dados.acp <- read.csv2('base_acp_scores.csv', sep=';')
glimpse(dados)
glimpse(dados.acp)
# within sum of squares
wss <- function(d) {
sum(scale(d, scale = FALSE)^2)
}
# wrap the data
wrap <- function(i, hc, x) {
cl <- cutree(hc, i)
spl <- split(x, cl)
wss <- sum(sapply(spl, wss))
wss
}
elbow_plot<- function(data, dissim,met){
cl = hclust(dissim, method = met)
res <- sapply(seq.int(1, nrow(data)),
wrap, h =cl,
x = data)
return(res)
}
knitr::opts_chunk$set(echo = FALSE)
if(!require(tidyverse)){install.packages("tidyverse")}
if(!require(cluster)){install.packages("cluster")}
if(!require(NbClust)){install.packages("NbClust")}
if(!require(pvclust)){install.packages('pvclust')}
if(!require(ggplot2)){install.packages('ggplot2')}
#if(!require(gridExtra)){install.packages('gridExtra')}
if(!require(plotly)){install.packages('plotly')}
library(corrplot)
cor <- cor(dados.acp)
cor <- cor(dados.acp[,3:7])
#cor
corrplot.mixed(cor, tl.col = "black")
library(corrplot)
cor <- cor(dados.acp[,3:7])
cor
corrplot.mixed(cor, tl.col = "black")
cor <- cor(t(dados.acp[,3:7]))
cor
library(corrplot)
cor <- cor(t(dados.acp[,3:7]))
#cor
corrplot.mixed(cor, tl.col = "black")
cor <- cor(dados.acp[,3:7])
cor
#cor
corrplot.mixed(cor, tl.col = "black")
?corrplot
library(corrplot)
cor <- cor(t(dados.acp[,3:7]))
#cor
#corrplot.mixed(cor, tl.col = "black")
corrplot(cor, tl.col = "black")
corrplot(cor, tl.col = "black")
dados.acp.num <- dados.acp[,3:7]
dis_euclidiana <- dist(dados.acp.num, method="euclidean")
nrow(data.cards)
elbow_data<-data.frame(ward = elbow_plot(data=dados.acp.num, dissim= dis_euclidiana,
met = "ward.D"),
upgma = elbow_plot(data=dados.acp.num,dissim= dis_euclidiana,
met = "average"),
wpgmc = elbow_plot(data=dados.acp.num,dissim= dis_euclidiana,
met = "median"),
wpgma = elbow_plot(data=dados.acp.num,dissim= dis_euclidiana,
met = "mcquitty"),
upgmc = elbow_plot(data=dados.acp.num,dissim= dis_euclidiana,
met = "centroid"),
k = seq.int(1, nrow(dados.acp.num))) %>%
gather(key="Metodo",value="WSS",-k)
elbow_data <- elbow_data %>% filter(k<=30)
ggplot(elbow_data %>% filter(k<=20),
aes(x=k,y=WSS,
group=Metodo,
color=Metodo,
alpha = 0.8)) +
geom_line(size=1.5 ,linetype = 1) + theme_bw()
?dist
ward <-hclust(dis_euclidiana, method = 'ward.D2')
upgma<-hclust(dis_euclidiana, method = 'average')
wpgmc<-hclust(dis_euclidiana, method = 'median')
wpgma<-hclust(dis_euclidiana, method = 'mcquitty')
upgmc<-hclust(dis_euclidiana, method = 'centroid')
par(mfrow=c(2,3))
plot(ward , main = 'Ward')
plot(upgma, main = 'UPGMA')
plot(wpgmc, main = 'WPGMC')
plot(wpgma, main = 'WPGMA')
plot(upgmc, main = 'UPGMC')
par(mfrow=c(1,1))
par(mfrow=c(2,3))
plot(ward , main = 'Ward')
plot(upgma, main = 'UPGMA')
plot(wpgmc, main = 'WPGMC')
plot(wpgma, main = 'WPGMA')
plot(upgmc, main = 'UPGMC')
par(mfrow=c(1,1))
plot(ward , main = 'Ward')
grupos.ward <- cutree(ward, k=6)
table(grupos.ward)
qplot(table(grupos.ward))
grupos.ward <- cutree(ward, k=6)
table(grupos.ward)
plot(table(grupos.ward))
grupos.ward <- cutree(ward, k=6)
table(grupos.ward)
qplot(table(grupos.ward))
grupos.ward <- cutree(ward, k=6)
table(grupos.ward)
qplot(t(table(grupos.ward)))
grupos.ward <- cutree(ward, k=6)
table(grupos.ward)
qplot(table(grupos.ward))
grupos.ward <- cutree(ward, k=6)
table(grupos.ward)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward)
qplot(table.ward[,1],table.ward[,2])
table.ward[,1]
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward)
table.ward[1]
t(table.ward)[1]
t(table.ward)
table.ward
View(table.ward)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward)
table.ward$freq
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
View(table.ward)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
qplot(table.ward)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
qplot(table.ward$Freq)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
qplot(table.ward$Freq, 1:6)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
qplot(1:6, table.ward$Freq)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
plot(1:6, table.ward$Freq)
?qplot
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
qplot(1:6, table.ward$Freq, geom ='histogram')
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
qplot(1:6, table.ward$Freq, geom ='histogram')
?plot
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
plot(1:6, table.ward$Freq, type ='h')
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
hist(1:6, table.ward$Freq)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
qplot(1:6, table.ward$Freq)
?plot_ly
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
#qplot(1:6, table.ward$Freq)
plot_ly(x=1:6, y=table.ward$Freq)
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
#qplot(1:6, table.ward$Freq)
plot_ly(x=1:6, y=table.ward$Freq,
type="bar" )
grupos.ward <- cutree(ward, k=5)
table.ward <- table(grupos.ward) %>% data.frame
plot_ly(x=1:6, y=table.ward$Freq, type="bar" )
grupos.ward <- cutree(ward, k=5)
table.ward <- table(grupos.ward) %>% data.frame
plot_ly(x=1:5, y=table.ward$Freq, type="bar" )
grupos.ward <- cutree(ward, k=6)
table.ward <- table(grupos.ward) %>% data.frame
plot_ly(x=1:6, y=table.ward$Freq, type="bar" )
grupos.ward <- cutree(ward, k=5)
table.ward <- table(grupos.ward) %>% data.frame
plot_ly(x=1:5, y=table.ward$Freq, type="bar" )
grupos.ward <- cutree(ward, k=5)
table.ward <- table(grupos.ward) %>% data.frame
table.ward
plot_ly(x=1:5, y=table.ward$Freq, type="bar" )
